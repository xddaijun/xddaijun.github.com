---
layout: default
title: Pinyin to Character
---
h1. Pinyin to Character

<p>用户输入拼音对拼音进行识别，一向是输入法来做的事情。在这里调用QQ的云端输入法来对输入的拼音进行识别，从而具备很高的匹配率。</p>
<p>代码如下，详见 &nbsp;<a href="https://github.com/xddaijun/somecode/blob/master/pycharacter/getwords.py">https://github.com/xddaijun/somecode/blob/master/pycharacter/getwords.py</a></p>
<style type="text/css">
<!--
pre { font-family: monospace; color: #f8f8f8; background-color: #141414; }
body { font-family: monospace; color: #f8f8f8; background-color: #141414; }
.lnr { color: #acacac; }
.Number { color: #c03030; }
.Function { color: #9b703f; }
.Statement { color: #ff7700; }
.String { color: #c03030; }
.Special { color: #4a9400; }
-->
</style>

<span class="lnr"> 1 </span><span class="Special"># -*- coding: utf-8 -*-</span>
<span class="lnr"> 2 </span><span class="String">&quot;&quot;&quot;</span>
<span class="lnr"> 3 </span><span class="String">Created on Sat Jun 25 16:37:12 2011</span>
<span class="lnr"> 4 </span>
<span class="lnr"> 5 </span><span class="String">@author: mark</span>
<span class="lnr"> 6 </span><span class="String">&quot;&quot;&quot;</span>
<span class="lnr"> 7 </span>
<span class="lnr"> 8 </span><span class="Statement">from</span> urllib <span class="Statement">import</span> urlopen
<span class="lnr"> 9 </span><span class="Statement">import</span> json
<span class="lnr">10 </span><span class="Statement">import</span> time
<span class="lnr">11 </span><span class="Statement">import</span> re
<span class="lnr">12 </span>
<span class="lnr">13 </span>
<span class="lnr">14 </span><span class="Statement">def</span> <span class="Function">getQQWords</span>(preword,pys,curNum):
<span class="lnr">15 </span>    <span class="Statement">global</span> wordsSet
<span class="lnr">16 </span>    <span class="Statement">if</span>(len(pys)&lt;<span class="Number">1</span> <span class="Statement">and</span> preword <span class="Statement">not</span> <span class="Statement">in</span> wordsSet):
<span class="lnr">17 </span>       wordsSet.append(preword)
<span class="lnr">18 </span>       <span class="Statement">return</span>
<span class="lnr">19 </span>    <span class="Statement">if</span> curNum&gt;<span class="Number">1</span>:
<span class="lnr">20 </span>        nextNum=curNum-<span class="Number">1</span>
<span class="lnr">21 </span>    <span class="Statement">else</span>:
<span class="lnr">22 </span>        nextNum=<span class="Number">1</span>
<span class="lnr">23 </span>    pylen=len(pys)
<span class="lnr">24 </span>    sout=json.load(urlopen(<span class="String">&quot;<a href="http://ime.qq.com/fcgi-bin/getword?q=%s">http://ime.qq.com/fcgi-bin/getword?q=%s</a>&quot;</span> % pys))
<span class="lnr">25 </span>    ix=<span class="Number">0</span>
<span class="lnr">26 </span>    <span class="Statement">while</span>(pylen&gt;=<span class="Number">1</span> <span class="Statement">and</span> ix&lt;curNum):
<span class="lnr">27 </span>        getQQWords(preword+sout[<span class="String">'rs'</span>][ix],pys[int(sout[<span class="String">'rsn'</span>][ix]):],nextNum)
<span class="lnr">28 </span>        ix=ix+<span class="Number">1</span>
<span class="lnr">29 </span>
<span class="lnr">30 </span><span class="Statement">def</span> <span class="Function">parsePY</span>(inputStr):
<span class="lnr">31 </span>    <span class="Statement">global</span> wordsSet
<span class="lnr">32 </span>    outwords=[]
<span class="lnr">33 </span>    match = re.search(<span class="String">r'^[a-zA-Z\'\s]+$'</span>, inputStr)
<span class="lnr">34 </span>    <span class="Statement">if</span> match:
<span class="lnr">35 </span>        matches=re.split(<span class="String">&quot;\s&quot;</span>,inputStr)
<span class="lnr">36 </span>        ix=<span class="Number">0</span>
<span class="lnr">37 </span>        <span class="Statement">if</span> len(matches)&gt;<span class="Number">1</span>:
<span class="lnr">38 </span>            outwords.append(<span class="String">&quot;&quot;</span>)
<span class="lnr">39 </span>            <span class="Statement">while</span> ix&lt;len(matches):
<span class="lnr">40 </span>                wordsSet=[]
<span class="lnr">41 </span>                getQQWords(<span class="String">&quot;&quot;</span>,matches[ix],<span class="Number">1</span>)
<span class="lnr">42 </span>                outwords[<span class="Number">0</span>]=outwords[<span class="Number">0</span>]+wordsSet[<span class="Number">0</span>]+<span class="String">&quot; &quot;</span>
<span class="lnr">43 </span>                ix=ix+<span class="Number">1</span>
<span class="lnr">44 </span>        <span class="Statement">else</span>:
<span class="lnr">45 </span>            wordsSet=[]
<span class="lnr">46 </span>            getQQWords(<span class="String">&quot;&quot;</span>,matches[ix],<span class="Number">3</span>)
<span class="lnr">47 </span>            outwords=wordsSet
<span class="lnr">48 </span>    <span class="Statement">return</span> outwords
<span class="lnr">49 </span>
<span class="lnr">50 </span><span class="Statement">def</span> <span class="Function">main</span>():
<span class="lnr">51 </span>    <span class="Statement">for</span> w <span class="Statement">in</span> parsePY(<span class="String">&quot;woshiyigerxi'anshi&quot;</span>):
<span class="lnr">52 </span>        print w
<span class="lnr">53 </span>
<span class="lnr">54 </span><span class="Statement">if</span> __name__ == <span class="String">'__main__'</span>:
<span class="lnr">55 </span>    start = time.clock()
<span class="lnr">56 </span>    main()
<span class="lnr">57 </span>    end = time.clock()
<span class="lnr">58 </span>    print <span class="String">'use time :%f'</span> % (end-start)

  
